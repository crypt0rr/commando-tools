<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Gem::Package - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link"><a href="../Object.html">Object</a>
</div>

    
<div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
    <li><a class="include" href="UserInteraction.html">Gem::UserInteraction</a>
  </ul>
</div>

    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-build">::build</a>
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    <li ><a href="#method-c-raw_spec">::raw_spec</a>
    <li ><a href="#method-i-add_checksums">#add_checksums</a>
    <li ><a href="#method-i-build">#build</a>
    <li ><a href="#method-i-contents">#contents</a>
    <li ><a href="#method-i-copy_to">#copy_to</a>
    <li ><a href="#method-i-extract_files">#extract_files</a>
    <li ><a href="#method-i-gzip_to">#gzip_to</a>
    <li ><a href="#method-i-initialize">#initialize</a>
    <li ><a href="#method-i-mkdir_p_safe">#mkdir_p_safe</a>
    <li ><a href="#method-i-normalize_path">#normalize_path</a>
    <li ><a href="#method-i-read_checksums">#read_checksums</a>
    <li ><a href="#method-i-setup_signer">#setup_signer</a>
    <li ><a href="#method-i-spec">#spec</a>
    <li ><a href="#method-i-verify">#verify</a>
    <li ><a href="#method-i-verify_entry">#verify_entry</a>
    <li ><a href="#method-i-verify_files">#verify_files</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Gem::Package">
  <h1 id="class-Gem::Package" class="class">
    class Gem::Package
  </h1>

  <section class="description">
    
  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-checksums" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">checksums</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Checksums for the contents of the package</p>
        </div>
      </div>
      <div id="attribute-i-data_mode" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">data_mode</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Permission for other files</p>
        </div>
      </div>
      <div id="attribute-i-dir_mode" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">dir_mode</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Permission for directories</p>
        </div>
      </div>
      <div id="attribute-i-files" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">files</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>The files in this package.  This is not the contents of the gem, just the files in the top-level container.</p>
        </div>
      </div>
      <div id="attribute-i-gem" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">gem</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Reference to the gem being packaged.</p>
        </div>
      </div>
      <div id="attribute-i-prog_mode" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">prog_mode</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Permission for program files</p>
        </div>
      </div>
      <div id="attribute-i-security_policy" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">security_policy</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The security policy used for verifying the contents of this package.</p>
        </div>
      </div>
      <div id="attribute-i-spec" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">spec</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        <p>Sets the <a href="Specification.html"><code>Gem::Specification</code></a> to use to build this package.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-build" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">build</span><span
            class="method-args">(spec, skip_validation = false, strict_validation = false, file_name = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="build-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">skip_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">strict_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">file_name</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">gem_file</span> = <span class="ruby-identifier">file_name</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">file_name</span>

  <span class="ruby-identifier">package</span> = <span class="ruby-identifier">new</span> <span class="ruby-identifier">gem_file</span>
  <span class="ruby-identifier">package</span>.<span class="ruby-identifier">spec</span> = <span class="ruby-identifier">spec</span>
  <span class="ruby-identifier">package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">skip_validation</span>, <span class="ruby-identifier">strict_validation</span>

  <span class="ruby-identifier">gem_file</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(gem, security_policy = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates a new Gem::Package for the file at <code>gem</code>. <code>gem</code> can also be provided as an <a href="../IO.html"><code>IO</code></a> object.</p>

<p>If <code>gem</code> is an existing file in the old format a <a href="Package/Old.html"><code>Gem::Package::Old</code></a> will be returned.</p>
            <div class="method-calls-super">
              Calls superclass method
              <a href="../BasicObject.html#method-c-new"><code>BasicObject::new</code></a>
            </div>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">new</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">security_policy</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">gem</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span>)
          <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:read</span>
          <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">IOSource</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FileSource</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">present?</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">start</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">start</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;MD5SUM =&#39;</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">Old</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-raw_spec" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">raw_spec</span><span
            class="method-args">(path, security_policy = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Extracts the <a href="Specification.html"><code>Gem::Specification</code></a> and raw metadata from the .gem file at <code>path</code>.</p>

          <div class="method-source-code" id="raw_spec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">raw_spec</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">security_policy</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">format</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">security_policy</span>)
  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">format</span>.<span class="ruby-identifier">spec</span>

  <span class="ruby-identifier">metadata</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>, <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">binary_mode</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">tar</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>
    <span class="ruby-identifier">tar</span>.<span class="ruby-identifier">each_entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;metadata&#39;</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">metadata</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;metadata.gz&#39;</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">gunzip</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>, <span class="ruby-identifier">metadata</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-add_checksums" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">add_checksums</span><span
            class="method-args">(tar)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Adds a checksum for each entry in the gem to checksums.yaml.gz.</p>

          <div class="method-source-code" id="add_checksums-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_checksums</span>(<span class="ruby-identifier">tar</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

  <span class="ruby-identifier">checksums_by_algorithm</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">algorithm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">algorithm</span>] = {} }

  <span class="ruby-ivar">@checksums</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">digests</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">digests</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">algorithm</span>, <span class="ruby-identifier">digest</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">checksums_by_algorithm</span>[<span class="ruby-identifier">algorithm</span>][<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">digest</span>.<span class="ruby-identifier">hexdigest</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">tar</span>.<span class="ruby-identifier">add_file_signed</span> <span class="ruby-string">&#39;checksums.yaml.gz&#39;</span>, <span class="ruby-value">0444</span>, <span class="ruby-ivar">@signer</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">gzip_to</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gz_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">checksums_by_algorithm</span>, <span class="ruby-identifier">gz_io</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-build" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">build</span><span
            class="method-args">(skip_validation = false, strict_validation = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Builds this package based on the specification set by <a href="Package.html#attribute-i-spec"><code>spec=</code></a></p>

          <div class="method-source-code" id="build-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 284</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">skip_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">strict_validation</span> = <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;skip_validation = true and strict_validation = true are incompatible&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_validation</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">strict_validation</span>

    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">mark_version</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">validate</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">strict_validation</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">skip_validation</span>

    <span class="ruby-identifier">setup_signer</span>(
      <span class="ruby-value">signer_options:</span> {
        <span class="ruby-value">expiration_length_days:</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">cert_expiration_length_days</span>,
      }
    )

    <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_write_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarWriter</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">add_metadata</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-identifier">add_contents</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-identifier">add_checksums</span> <span class="ruby-identifier">gem</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">say</span> <span class="ruby-identifier">&lt;&lt;-EOM</span>
<span class="ruby-value">  Successfully built RubyGem
  Name: #{@spec.name}
  Version: #{@spec.version}
  File: #{File.basename @gem.path}
</span><span class="ruby-identifier">EOM</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-ivar">@signer</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-contents" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">contents</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>A list of file names contained in this gem</p>

          <div class="method-source-code" id="contents-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">contents</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@contents</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contents</span>

  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-ivar">@contents</span> = []

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">gem_tar</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>

    <span class="ruby-identifier">gem_tar</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>

      <span class="ruby-identifier">open_tar_gz</span> <span class="ruby-identifier">entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pkg_tar</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">pkg_tar</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">contents_entry</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@contents</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">contents_entry</span>.<span class="ruby-identifier">full_name</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@contents</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-copy_to" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">copy_to</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Copies this package to <code>path</code> (if possible)</p>

          <div class="method-source-code" id="copy_to-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">copy_to</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span> <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-extract_files" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">extract_files</span><span
            class="method-args">(destination_dir, pattern = &quot;*&quot;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Extracts the files in this package into <code>destination_dir</code></p>

<p>If <code>pattern</code> is specified, only entries matching that glob will be extracted.</p>

          <div class="method-source-code" id="extract_files-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">extract_files</span>(<span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">pattern</span> = <span class="ruby-string">&quot;*&quot;</span>)
  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">destination_dir</span>, <span class="ruby-value">:mode</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">dir_mode</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">0755</span>

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">reader</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>

    <span class="ruby-identifier">reader</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>

      <span class="ruby-identifier">extract_tar_gz</span> <span class="ruby-identifier">entry</span>, <span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">pattern</span>

      <span class="ruby-keyword">return</span> <span class="ruby-comment"># ignore further entries</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-gzip_to" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">gzip_to</span><span
            class="method-args">(io) { |gz_io| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Gzips content written to <code>gz_io</code> to <code>io</code>.</p>

          <div class="method-source-code" id="gzip_to-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">gzip_to</span>(<span class="ruby-identifier">io</span>) <span class="ruby-comment"># :yields: gz_io</span>
  <span class="ruby-identifier">gz_io</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>, <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_COMPRESSION</span>
  <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">mtime</span> = <span class="ruby-ivar">@build_time</span>

  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">gz_io</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">close</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-mkdir_p_safe" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">mkdir_p_safe</span><span
            class="method-args">(mkdir, mkdir_options, destination_dir, file_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="mkdir_p_safe-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 497</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mkdir_p_safe</span>(<span class="ruby-identifier">mkdir</span>, <span class="ruby-identifier">mkdir_options</span>, <span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">file_name</span>)
  <span class="ruby-identifier">destination_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">realpath</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">destination_dir</span>))
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">mkdir</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>)
  <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">reduce</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">basename</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">realpath</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">basename</span>)
    <span class="ruby-identifier">lstat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">lstat</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lstat</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lstat</span>.<span class="ruby-identifier">directory?</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">normalize_path</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">start_with?</span> <span class="ruby-identifier">normalize_path</span>(<span class="ruby-identifier">destination_dir</span>) <span class="ruby-keyword">and</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">mkdir_options</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">false</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">PathError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file_name</span>, <span class="ruby-identifier">destination_dir</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-normalize_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">normalize_path</span><span
            class="method-args">(pathname)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="normalize_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 489</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">normalize_path</span>(<span class="ruby-identifier">pathname</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
    <span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">pathname</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-read_checksums" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">read_checksums</span><span
            class="method-args">(gem)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Reads and loads checksums.yaml.gz from the tar file <code>gem</code></p>

          <div class="method-source-code" id="read_checksums-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 541</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_checksums</span>(<span class="ruby-identifier">gem</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

  <span class="ruby-ivar">@checksums</span> = <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">seek</span> <span class="ruby-string">&#39;checksums.yaml.gz&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipReader</span>.<span class="ruby-identifier">wrap</span> <span class="ruby-identifier">entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gz_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeYAML</span>.<span class="ruby-identifier">safe_load</span> <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">read</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-setup_signer" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">setup_signer</span><span
            class="method-args">(signer_options: {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Prepares the gem for signing and checksum generation.  If a signing certificate and key are not present only checksum generation is set up.</p>

          <div class="method-source-code" id="setup_signer-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">setup_signer</span>(<span class="ruby-value">signer_options:</span> {})
  <span class="ruby-identifier">passphrase</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span>
    <span class="ruby-ivar">@signer</span> =
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Signer</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span>,
        <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span>,
        <span class="ruby-identifier">passphrase</span>,
        <span class="ruby-identifier">signer_options</span>
      )

    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cert</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">to_s</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@signer</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Signer</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">passphrase</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cert</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">to_pem</span> } <span class="ruby-keyword">if</span>
      <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-spec" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">spec</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The spec for this gem.</p>

<p>If this is a package for a built gem the spec is loaded from the gem and returned.  If this is a package for a gem being built the provided spec is returned.</p>

          <div class="method-source-code" id="spec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 582</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">spec</span>
  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-ivar">@spec</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-verify" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">verify</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Verifies that this gem:</p>
<ul><li>
<p>Contains a valid gem specification</p>
</li><li>
<p>Contains a contents archive</p>
</li><li>
<p>The contents archive is not corrupt</p>
</li></ul>

<p>After verification the gem specification from the gem is available from <a href="Package.html#method-i-spec"><code>spec</code></a></p>

          <div class="method-source-code" id="verify-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 598</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify</span>
  <span class="ruby-ivar">@files</span>     = []
  <span class="ruby-ivar">@spec</span>      = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reader</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">read_checksums</span> <span class="ruby-identifier">reader</span>

      <span class="ruby-identifier">verify_files</span> <span class="ruby-identifier">reader</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">verify_checksums</span> <span class="ruby-ivar">@digests</span>, <span class="ruby-ivar">@checksums</span>

  <span class="ruby-ivar">@security_policy</span>.<span class="ruby-identifier">verify_signatures</span> <span class="ruby-ivar">@spec</span>, <span class="ruby-ivar">@digests</span>, <span class="ruby-ivar">@signatures</span> <span class="ruby-keyword">if</span>
    <span class="ruby-ivar">@security_policy</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>
  <span class="ruby-ivar">@spec</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@files</span> = []
  <span class="ruby-identifier">raise</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarInvalidError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>, <span class="ruby-ivar">@gem</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-verify_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">verify_entry</span><span
            class="method-args">(entry)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Verifies <code>entry</code> in a .gem file.</p>

          <div class="method-source-code" id="verify_entry-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 648</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify_entry</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-identifier">file_name</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file_name</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">file_name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/\.sig$/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@signatures</span>[<span class="ruby-node">$`</span>] = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@security_policy</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">digest</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">file_name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;metadata&quot;</span>, <span class="ruby-string">&quot;metadata.gz&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">load_spec</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">verify_gz</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span>
  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Exception while verifying #{@gem.path}&quot;</span>
  <span class="ruby-identifier">raise</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-verify_files" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">verify_files</span><span
            class="method-args">(gem)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Verifies the files of the <code>gem</code></p>

          <div class="method-source-code" id="verify_files-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 674</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify_files</span>(<span class="ruby-identifier">gem</span>)
  <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">verify_entry</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-string">&#39;package metadata is missing&#39;</span>, <span class="ruby-ivar">@gem</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> \
            <span class="ruby-string">&#39;package content (data.tar.gz) is missing&#39;</span>, <span class="ruby-ivar">@gem</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">duplicates</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span> }.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">duplicates</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;duplicate files in the package: (#{duplicates.map(&amp;:inspect).join(&#39;, &#39;)})&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

      <div id="method-i-initialize" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">initialize</span><span
            class="method-args">(gem, security_policy)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates a new package that will read or write to the file <code>gem</code>.</p>

          <div class="method-source-code" id="initialize-source">
            <pre><span class="ruby-comment"># File lib/rubygems/package.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">security_policy</span>) <span class="ruby-comment"># :notnew:</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;zlib&#39;</span>

  <span class="ruby-ivar">@gem</span> = <span class="ruby-identifier">gem</span>

  <span class="ruby-ivar">@build_time</span>      = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">source_date_epoch</span>
  <span class="ruby-ivar">@checksums</span>       = {}
  <span class="ruby-ivar">@contents</span>        = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@digests</span>         = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">algorithm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">algorithm</span>] = {} }
  <span class="ruby-ivar">@files</span>           = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@security_policy</span> = <span class="ruby-identifier">security_policy</span>
  <span class="ruby-ivar">@signatures</span>      = {}
  <span class="ruby-ivar">@signer</span>          = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@spec</span>            = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

